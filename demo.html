<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Backlot demo</title>

    <style type="text/css">
      body{
        background-color: #050505;
        color: #BEBEBE;
        font-family: arial, sans-serif;
        max-width: 1280px;
        margin: 0px auto;
        padding: 1em;
      }
      #fps_meter{
        position: absolute;
        bottom: 1.2em;
        left: 1.1em;
        width: 200px;
        margin: 0px auto;
        min-height: 3em;
      }
      #game_canvas{
        border: 1px solid #333;
        background-color: #000;
        cursor: none;
        display: block;
        margin: 0px auto;
      }
      #container{
        width: 1280px;
        margin: 0px auto;
        position: relative;
      }
      input {
        padding: 0.1em;
        font-size: 1.2em;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <div id="fps_meter"></div>
      <div id="game">
        <canvas id="game_canvas" width="1280" height="720"></canvas>
      </div>
    </div>
    <div>
      <ul>
        <li>W, A, S, D to move</li>
      </ul>
    </div>

    <script type="text/javascript" src="src/libs/matter.js"></script>
    <script type="text/javascript" src="src/libs/matter_collision_events.js"></script>
    <script type="text/javascript" src="src/util.js"></script>
    <script type="text/javascript" src="src/util/vector.js"></script>
    <script type="text/javascript" src="src/meter.js"></script>
    <script type="text/javascript" src="src/cursor.js"></script>
    <script type="text/javascript" src="src/viewport.js"></script>
    <script type="text/javascript" src="src/engine.js"></script>
    <script type="text/javascript" src="src/world/layer.js"></script>
    <script type="text/javascript" src="src/world.js"></script>
    <script type="text/javascript" src="src/asset_depot.js"></script>
    <script type="text/javascript" src="src/entity.js"></script>
    <script type="text/javascript" src="src/entities/sprite.js"></script>
    <script type="text/javascript" src="src/entities/animation.js"></script>
    <script type="text/javascript" src="src/game.js"></script>

    <script type="text/javascript">
      const game = new Game("game_canvas");
      game.set_fps_meter("fps_meter");

      class Wall extends Entity {
        constructor(x, y, width, height, angle){
          super(x, y, width, height, angle);
          this.add_physics_body({isStatic: true});
        }
        render(ctx){
          ctx.fillStyle = "#080812";
          ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
          super.render(ctx);
        }
      }

      class Floor extends Entity {
        constructor(x, y, width, height, angle){
          super(x, y, width, height, angle);
        }
        render(ctx){
          ctx.fillStyle = "#050509";
          ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
          super.render(ctx);
        }
      }

      class Light extends Entity {
        constructor(x, y, width, height, angle){
          super(x, y, width, height, angle);
        }
        render(ctx){
          ctx.strokeStyle = "#9999CC";
          ctx.fillStyle = "rgba(100, 100, 200, 0.5)";
          ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
          ctx.strokeRect(-this.width/2, -this.height/2, this.width, this.height);
          super.render(ctx);
        }
      }

      class Player extends Entity {
        constructor(x, y){
          super(x, y, 32, 32);
          this.add_physics_body();
        }
        update(dt){
          super.update(dt);
          let x_offset = 0;
          let y_offset = 0;
          if(this.up) y_offset -= dt*500;
          if(this.down) y_offset += dt*500;
          if(this.left) x_offset -= dt*500;
          if(this.right) x_offset += dt*500;
          Matter.Body.setPosition(this.physics_body, {x: this.x+x_offset, y: this.y+y_offset});
        }
        render(ctx){
          ctx.fillStyle = "#FFFFFF";
          ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
          super.render(ctx);
        }
      }
      game.set_scene({
        world: new World(1920*3, 1080*3),
        setup: function(){
          this.player = new Player(0, 0);
          this.add(this.player);
          this.add(new Floor(0, 0, 1024, 1024), 99);
          this.add(new Floor(-512, 1024, 1024, 1024), 99);

          this.add(new Light(-256, 256, 128, 128), 150);
          this.add(new Light(256, -256, 128, 128), 150);
          this.add(new Light(256, 256, 128, 128), 150);
          this.add(new Light(-256, -256, 128, 128), 150);
          this.add(new Light(-512, 1024, 128, 128), 150);

          this.add(new Wall(-512, 0, 64, 1024));
          this.add(new Wall(512, 0, 64, 1024));
          this.add(new Wall(256, 512, 512, 64));
          this.add(new Wall(0, -512, 1024, 64));
          this.add(new Wall(0, 1024, 64, 1024));
          this.add(new Wall(-512-256, 512, 512, 64));
          this.add(new Wall(-1024, 1024, 64, 1024));
          this.add(new Wall(-512, 1024+512, 1024, 64));

          this.add(new Wall(128, 128, 64, 64));
          this.add(new Wall(128, 256, 64, 64));
          this.add(new Wall(256, 256, 64, 64));
          this.add(new Wall(256, 128, 64, 64));

          this.add(new Wall(128-1024, 256+128+512, 128, 128));
          this.add(new Wall(128-1024, 256+256+512+32, 128, 128));
          this.add(new Wall(256-1024+32, 256+256+512+32, 128, 128));
          this.add(new Wall(256-1024+32, 256+128+512, 128, 128));
          this.add(new Wall(512-1024, 256+256+512+32, 256, 128));
          this.add(new Wall(512-1024, 256+128+512, 256, 128));

          this.add(new Light(-16, 1024, 16, 16), 115);
          this.add(new Light(-24, 1024+8, 16, 16), 115);
          this.add(new Light(-32, 1024-10, 16, 16), 115);
          this.add(new Light(-64, 1024+32, 16, 16), 115);
          this.add(new Light(-76, 1024+16, 16, 16), 115);
          this.game.engine.viewport.track(this.player);
        },
        handle_key(event, pressed){
          if(event.key == "w") this.player.up = pressed;
          if(event.key == "s") this.player.down = pressed;
          if(event.key == "a") this.player.left = pressed;
          if(event.key == "d") this.player.right = pressed;
        },
      });
      game.run();
    </script>

  </body>
</html>
