<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Backlot demo</title>

    <style type="text/css">
      body{
        background-color: #050505;
        color: #BEBEBE;
        font-family: arial, sans-serif;
        max-width: 1280px;
        margin: 0px auto;
        padding: 1em;
      }
      #fps_meter{
        position: absolute;
        bottom: 1.2em;
        left: 1.1em;
        width: 200px;
        margin: 0px auto;
        min-height: 3em;
      }
      #game_canvas{
        border: 1px solid #333;
        background-color: #000;
        cursor: none;
        display: block;
        margin: 0px auto;
      }
      #container{
        width: 1280px;
        margin: 0px auto;
        position: relative;
      }
      input {
        padding: 0.1em;
        font-size: 1.2em;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <div id="fps_meter"></div>
      <div id="game">
        <canvas id="game_canvas" width="1280" height="720"></canvas>
      </div>
    </div>

    <script type="text/javascript" src="src/util.js"></script>
    <script type="text/javascript" src="src/meter.js"></script>
    <script type="text/javascript" src="src/cursor.js"></script>
    <script type="text/javascript" src="src/viewport.js"></script>
    <script type="text/javascript" src="src/engine.js"></script>
    <script type="text/javascript" src="src/world/layer.js"></script>
    <script type="text/javascript" src="src/world.js"></script>
    <script type="text/javascript" src="src/asset_depot.js"></script>
    <script type="text/javascript" src="src/entity.js"></script>
    <script type="text/javascript" src="src/entities/sprite.js"></script>
    <script type="text/javascript" src="src/entities/animation.js"></script>
    <script type="text/javascript" src="src/game.js"></script>

    <script type="text/javascript">
      const game = new Game("game_canvas");
      game.set_fps_meter("fps_meter");

      class Tower extends Entity {
        constructor(x, y){
          super(x, y, 50, 70);
          this.sprite = new Sprite(game.add_image("turret.png"));
        }
        update(dt){
          super.update(dt);
          this.sprite.x = this.x;
          this.sprite.y = this.y;
          this.sprite.width = this.width;
          this.sprite.height = this.height;
        }
        render(ctx){
          this.sprite.render(ctx);
        }
      }

      class Player extends Entity {
        constructor(x, y){
          super(x, y, 50, 70);
          this.sprite = new Animation([
            game.add_image("person_n.png"),
            game.add_image("person_ne.png"),
            game.add_image("person_e.png"),
            game.add_image("person_se.png"),
            game.add_image("person_s.png"),
            game.add_image("person_sw.png"),
            game.add_image("person_w.png"),
            game.add_image("person_nw.png"),
          ]);
          this.sprite.speed = 8;
        }
        update_sprite(dt){
          this.sprite.update(dt);
          this.sprite.x = this.x;
          this.sprite.y = this.y;
          this.sprite.width = this.width;
          this.sprite.height = this.height;
        }
        update(dt){
          super.update(dt);
          this.update_sprite(dt);
        }
        render(ctx){
          this.sprite.render(ctx);
        }
      }

      game.set_scene({
        world: new World(1280*2, 720*2),

        setup: (scene, game) => {
          scene.add_entity(new Sprite(game.add_image("world.png"), 0, 0, 1280*2, 720*2));
          scene.player = new Player(100, 100);
          scene.add_entity(scene.player);
          game.engine.viewport.track(scene.player);
          game.add_audio("bang1.mp3");
        },

        update: (scene, dt, game) => {
          let world_coords = game.engine.viewport.viewport_to_world(game.engine.cursor.x, game.engine.cursor.y);
          scene.player.x = world_coords[0];
          scene.player.y = world_coords[1];
        },

        handle_mouse_button: (scene, event, pressed) => {
          if(!pressed) return;
          let world_coords = game.engine.viewport.viewport_to_world(game.engine.cursor.x, game.engine.cursor.y);
          scene.add_entity(new Tower(world_coords[0], world_coords[1]));
          game.audio["bang1.mp3"].currentTime = 0;
          game.audio["bang1.mp3"].play();
        }
      });

      game.run();
    </script>

  </body>
</html>
