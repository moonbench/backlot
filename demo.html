<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Backlot demo</title>

    <style type="text/css">
      body{
        background-color: #050505;
        color: #BEBEBE;
        font-family: arial, sans-serif;
        max-width: 1280px;
        margin: 0px auto;
        padding: 1em;
      }
      #fps_meter{
        position: absolute;
        bottom: 1.2em;
        left: 1.1em;
        width: 200px;
        margin: 0px auto;
        min-height: 3em;
      }
      #game_canvas{
        border: 1px solid #333;
        background-color: #000;
        cursor: none;
        display: block;
        margin: 0px auto;
      }
      #container{
        width: 1280px;
        margin: 0px auto;
        position: relative;
      }
      input {
        padding: 0.1em;
        font-size: 1.2em;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <div id="fps_meter"></div>
      <div id="game">
        <canvas id="game_canvas" width="1280" height="720"></canvas>
      </div>
    </div>

    <script type="text/javascript" src="src/libs/matter.js"></script>
    <script type="text/javascript" src="src/util.js"></script>
    <script type="text/javascript" src="src/util/vector.js"></script>
    <script type="text/javascript" src="src/meter.js"></script>
    <script type="text/javascript" src="src/cursor.js"></script>
    <script type="text/javascript" src="src/viewport.js"></script>
    <script type="text/javascript" src="src/engine.js"></script>
    <script type="text/javascript" src="src/world/layer.js"></script>
    <script type="text/javascript" src="src/world.js"></script>
    <script type="text/javascript" src="src/asset_depot.js"></script>
    <script type="text/javascript" src="src/entity.js"></script>
    <script type="text/javascript" src="src/entities/sprite.js"></script>
    <script type="text/javascript" src="src/entities/animation.js"></script>
    <script type="text/javascript" src="src/game.js"></script>

    <script type="text/javascript">
      const game = new Game("game_canvas");
      game.set_fps_meter("fps_meter");

      class Bullet extends Entity {
        constructor(x, y){
          super(x, y, 5, 30);
          this.age = 0;
          this.physics = Matter.Bodies.rectangle(this.x, this.y, this.width, this.height);
          Matter.Body.setVelocity(this.physics, {x: 0, y: -25});
        }
        update(dt){
          super.update(dt);
          this.x = this.physics.position.x;
          this.y = this.physics.position.y;
          this.angle = this.physics.angle;
          this.age += dt;
          if(this.age >= 1){
            this.dead = true;
          }
        }
      }

      class Fighter extends Entity {
        constructor(){
          super(0, 250, 40, 30);
          this.move_left = false;
          this.move_right = false;
          this.shooting = false;
          this.time_since_last_shot = 0;
        }

        set_move_left(enabled){
          this.move_left = enabled;
        }
        set_move_right(enabled){
          this.move_right = enabled;
        }
        update(dt){
          super.update(dt);
          if(this.move_left)
            this.x -= dt*300;
          if(this.move_right)
            this.x += dt*300;
          if(this.shooting){
            if(this.time_since_last_shot == 0){              
              game.scene.add(new Bullet(this.x, this.y-20));
            }
            this.time_since_last_shot += dt;
            if(this.time_since_last_shot >= 0.1){
              this.time_since_last_shot = 0;
            }
          }
        }
        shoot(enabled){
          this.shooting = enabled;
        }
      }


      class Enemy extends Entity {
        constructor(x, y){
          super(0, y, 200, 20);
          this.physics = Matter.Bodies.rectangle(this.x, this.y, this.width, this.height);
        }
        update(dt){
          super.update(dt);
          this.x = this.physics.position.x;
          this.y = this.physics.position.y;
          this.angle = this.physics.angle;
        }
      }


      game.set_scene({
        world: new World(1280, 720),

        setup: function(){
          this.fighter = new Fighter();
          this.add(this.fighter);
          this.enemy = new Enemy();
          this.add(this.enemy);
        },

        handle_key: function(event, pressed){
          if(event.key === "ArrowLeft")
            this.fighter.set_move_left(pressed);
          if(event.key === "ArrowRight")
            this.fighter.set_move_right(pressed);
          if(event.key === " ")
            this.fighter.shoot(pressed);
        }
      });

      game.run();
    </script>

  </body>
</html>
